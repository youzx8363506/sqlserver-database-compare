# 表比较逻辑测试场景

## 测试用例

### 场景1：源库没有表，目标库有表
- **源数据库**: 0个表
- **目标数据库**: 3个表 (Table1, Table2, Table3)
- **预期结果**: 
  ```javascript
  {
    added: [Table1, Table2, Table3],    // 3个新增表
    removed: [],                        // 0个删除表
    modified: []                        // 0个修改表
  }
  ```
- **前端显示**: "表结构: 3 个差异" (显示为新增)

### 场景2：源库有表，目标库没有表  
- **源数据库**: 3个表 (Table1, Table2, Table3)
- **目标数据库**: 0个表
- **预期结果**:
  ```javascript
  {
    added: [],                          // 0个新增表
    removed: [Table1, Table2, Table3],  // 3个删除表
    modified: []                        // 0个修改表
  }
  ```
- **前端显示**: "表结构: 3 个差异" (显示为删除)

### 场景3：部分重叠
- **源数据库**: 2个表 (Table1, Table2)
- **目标数据库**: 2个表 (Table2, Table3)
- **预期结果**:
  ```javascript
  {
    added: [Table3],      // 1个新增表
    removed: [Table1],    // 1个删除表
    modified: []          // 0个修改表 (Table2相同)
  }
  ```
- **前端显示**: "表结构: 2 个差异"

## 代码逻辑验证 ✅

### TableComparer.compareTables() 逻辑：

1. **建立映射**:
   ```typescript
   const sourceMap = new Map(sourceTables.map(t => [`${t.schemaName}.${t.tableName}`, t]));
   const targetMap = new Map(targetTables.map(t => [`${t.schemaName}.${t.tableName}`, t]));
   ```

2. **查找新增表** (目标有，源没有):
   ```typescript
   for (const [key, table] of targetMap) {
     if (!sourceMap.has(key)) {
       added.push(table);    // ✅ 正确处理
     }
   }
   ```

3. **查找删除表** (源有，目标没有):
   ```typescript
   for (const [key, sourceTable] of sourceMap) {
     if (!targetMap.get(key)) {
       removed.push(sourceTable);    // ✅ 正确处理
     }
   }
   ```

## 结论

**当前比较逻辑是正确的**！

- ✅ 处理源库有，目标库没有 → `removed`
- ✅ 处理目标库有，源库没有 → `added`  
- ✅ 处理两库都有但不同 → `modified`

## 下一步测试

用户可以测试以下场景：
1. 创建一个有表的数据库作为目标库
2. 创建一个空数据库作为源库
3. 进行比较，应该看到"新增了N个表"