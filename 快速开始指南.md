# SQL Server 数据库比较工具 - 快速开始指南

## 概述

这是一个基于 Node.js 的 SQL Server 数据库比较工具，能够比较两个数据库之间的结构差异，包括表、索引、视图、存储过程和函数，并生成详细的比较报告。

## 快速开始

### 1. 环境准备

确保您的开发环境满足以下要求：

- **Node.js**: 版本 16.x 或以上
- **npm**: 版本 8.x 或以上  
- **SQL Server**: 2012 或以上版本
- **Windows**: 推荐 Windows 10/11（支持其他平台）

### 2. 项目初始化

```bash
# 1. 克隆或创建项目目录
cd D:\code\sqlserverdatabasecompare

# 2. 初始化 Node.js 项目
npm init -y

# 3. 安装核心依赖
npm install mssql commander inquirer chalk ora handlebars exceljs winston dotenv joi

# 4. 安装开发依赖
npm install --save-dev typescript @types/node @types/mssql @types/inquirer @types/handlebars ts-node nodemon jest @types/jest eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin

# 5. 初始化 TypeScript
npx tsc --init
```

### 3. 配置文件设置

创建基本的配置文件：

**package.json** (更新 scripts 部分):
```json
{
  "scripts": {
    "build": "tsc",
    "dev": "ts-node src/app.ts",
    "start": "node dist/app.js",
    "test": "jest",
    "lint": "eslint src/**/*.ts",
    "clean": "rimraf dist",
    "cli": "ts-node src/cli/index.ts"
  }
}
```

**tsconfig.json** (参考技术实现指南中的配置)

**.env.example**:
```env
# 源数据库配置
SOURCE_SERVER=localhost
SOURCE_DATABASE=Database1
SOURCE_AUTH_TYPE=sql
SOURCE_USERNAME=sa
SOURCE_PASSWORD=your_password

# 目标数据库配置
TARGET_SERVER=localhost
TARGET_DATABASE=Database2
TARGET_AUTH_TYPE=windows

# 输出配置
OUTPUT_DIRECTORY=./reports
DEFAULT_FORMAT=html

# 日志配置
LOG_LEVEL=info
```

### 4. 创建基础目录结构

```bash
mkdir -p src/{config,connections,extractors,comparers,reporters,types,utils,cli/commands}
mkdir -p dist reports tests
```

### 5. 第一个工作示例

创建一个简单的概念验证版本：

**src/app.ts**:
```typescript
import * as sql from 'mssql';

async function testConnection() {
  const config = {
    server: 'localhost',
    database: 'master',
    authentication: {
      type: 'default' as const
    },
    options: {
      encrypt: false,
      trustServerCertificate: true
    }
  };

  try {
    const pool = await sql.connect(config);
    const result = await pool.request().query('SELECT @@VERSION as version');
    console.log('数据库连接成功!');
    console.log('SQL Server 版本:', result.recordset[0].version);
    await pool.close();
  } catch (error) {
    console.error('连接失败:', error);
  }
}

testConnection();
```

### 6. 测试基础功能

```bash
# 测试数据库连接
npm run dev

# 如果连接成功，您应该看到 SQL Server 版本信息
```

### 7. 开发步骤建议

按照以下顺序开发核心功能：

#### 第一阶段：基础连接 (第1-2天)
1. 实现 `DatabaseConnection` 类
2. 测试不同认证方式的连接
3. 添加连接池管理

#### 第二阶段：数据提取 (第3-5天)
1. 实现 `TableExtractor` - 提取表结构
2. 实现 `IndexExtractor` - 提取索引信息
3. 实现 `ViewExtractor` - 提取视图定义
4. 实现 `ProcedureExtractor` - 提取存储过程
5. 实现 `FunctionExtractor` - 提取函数

#### 第三阶段：比较逻辑 (第6-8天)
1. 实现基础比较算法
2. 开发差异检测逻辑
3. 实现结果数据结构

#### 第四阶段：报告生成 (第9-10天)
1. 实现 HTML 报告生成器
2. 实现 Excel 报告生成器
3. 实现 JSON 导出功能

#### 第五阶段：CLI 接口 (第11-12天)
1. 实现命令行参数解析
2. 添加交互式配置
3. 集成所有功能模块

### 8. 调试和测试

**创建测试数据库**:
```sql
-- 创建测试数据库
CREATE DATABASE TestDB1;
CREATE DATABASE TestDB2;

-- 在 TestDB1 中创建一些测试对象
USE TestDB1;
CREATE TABLE Users (
    ID int PRIMARY KEY,
    Name nvarchar(50) NOT NULL,
    Email nvarchar(100)
);

-- 在 TestDB2 中创建略有不同的结构
USE TestDB2;
CREATE TABLE Users (
    ID int PRIMARY KEY,
    Name nvarchar(100) NOT NULL,  -- 长度不同
    Email nvarchar(100),
    CreatedDate datetime2 DEFAULT GETDATE()  -- 新增列
);
```

### 9. 常见问题解决

**连接问题**:
- 确保 SQL Server 允许远程连接
- 检查防火墙设置
- 验证认证方式配置

**权限问题**:
- 确保数据库用户有足够权限查询系统视图
- 需要 `VIEW DEFINITION` 权限

**性能问题**:
- 对大型数据库使用分页查询
- 考虑并行处理多个对象

### 10. 下一步

1. 阅读 `项目方案.md` 了解完整架构
2. 参考 `SQL查询参考.md` 获取数据提取查询
3. 查看 `技术实现指南.md` 获取详细代码示例
4. 开始实现第一个模块（推荐从数据库连接开始）

## 开发工作流

```bash
# 日常开发流程
git checkout -b feature/table-extractor  # 创建功能分支
npm run dev                              # 开发模式
npm run test                            # 运行测试
npm run lint                            # 代码检查
npm run build                           # 构建验证
git commit -m "实现表结构提取功能"        # 提交代码
```

## 获取帮助

- 查看项目文档目录中的详细指南
- 检查代码注释和类型定义
- 测试用例可以作为使用示例

祝您开发顺利！