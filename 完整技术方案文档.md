# SQL Serveræ•°æ®åº“æ¯”è¾ƒå·¥å…· - å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æ•´ä½“æ¶æ„](#2-æ•´ä½“æ¶æ„)
3. [æŠ€æœ¯æ ˆåˆ†æ](#3-æŠ€æœ¯æ ˆåˆ†æ)
4. [æ•°æ®åº“è¿æ¥æ¶æ„](#4-æ•°æ®åº“è¿æ¥æ¶æ„)
5. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#5-æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
6. [Webåº”ç”¨æ¶æ„](#6-webåº”ç”¨æ¶æ„)
7. [å®æ—¶é€šä¿¡æœºåˆ¶](#7-å®æ—¶é€šä¿¡æœºåˆ¶)
8. [æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ](#8-æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ)
9. [æ•°æ®ç¼“å­˜ä¸ä¼šè¯ç®¡ç†](#9-æ•°æ®ç¼“å­˜ä¸ä¼šè¯ç®¡ç†)
10. [éƒ¨ç½²æ¶æ„](#10-éƒ¨ç½²æ¶æ„)
11. [æ€§èƒ½ä¼˜åŒ–](#11-æ€§èƒ½ä¼˜åŒ–)
12. [å®‰å…¨æœºåˆ¶](#12-å®‰å…¨æœºåˆ¶)
13. [æ‰©å±•æ€§è®¾è®¡](#13-æ‰©å±•æ€§è®¾è®¡)
14. [è¿ç»´ç›‘æ§](#14-è¿ç»´ç›‘æ§)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

SQL Serveræ•°æ®åº“æ¯”è¾ƒå·¥å…·æ˜¯ä¸€ä¸ªåŸºäºNode.jsçš„ä¼ä¸šçº§æ•°æ®åº“ç»“æ„æ¯”è¾ƒè§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¯¹SQL Serveræ•°æ®åº“è¿›è¡Œå…¨é¢çš„ç»“æ„å·®å¼‚åˆ†æï¼ŒåŒ…æ‹¬è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ç­‰æ•°æ®åº“å¯¹è±¡çš„æ¯”è¾ƒã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§

- **å¤šæ¨¡å¼æ”¯æŒ**: CLIå‘½ä»¤è¡Œæ¨¡å¼å’ŒWebç•Œé¢æ¨¡å¼
- **å…¨å¯¹è±¡æ¯”è¾ƒ**: æ”¯æŒè¡¨ç»“æ„ã€ç´¢å¼•ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°çš„æ·±åº¦æ¯”è¾ƒ
- **å®æ—¶è¿›åº¦è·Ÿè¸ª**: åŸºäºWebSocketçš„å®æ—¶è¿›åº¦æ›´æ–°å’Œæ—¥å¿—æ¨é€
- **å¤šæ ¼å¼æŠ¥å‘Š**: è‡ªåŠ¨ç”ŸæˆHTMLã€Excelã€JSONæ ¼å¼çš„è¯¦ç»†æ¯”è¾ƒæŠ¥å‘Š
- **ä¼šè¯æ¢å¤**: æ”¯æŒä»»åŠ¡ä¼šè¯æ¢å¤å’Œæ•°æ®ç¼“å­˜æœºåˆ¶
- **åŒé‡è®¤è¯**: åŒæ—¶æ”¯æŒWindowsé›†æˆè®¤è¯å’ŒSQL Serverè®¤è¯

### 1.3 æŠ€æœ¯ç›®æ ‡

- **é«˜å¯ç”¨æ€§**: 99.9%çš„æœåŠ¡å¯ç”¨æ€§ä¿éšœ
- **é«˜æ€§èƒ½**: æ”¯æŒå¤§å‹æ•°æ®åº“(1000+è¡¨)çš„å¿«é€Ÿæ¯”è¾ƒ
- **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒåŠŸèƒ½æ‰©å±•
- **ç”¨æˆ·ä½“éªŒ**: ç°ä»£åŒ–çš„Webç•Œé¢å’Œç®€æ´çš„CLIå·¥å…·

---

## 2. æ•´ä½“æ¶æ„

### 2.1 å¤šå±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æ¥å£å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CLIå·¥å…·           â”‚    Webå‰ç«¯ç•Œé¢ (React + Ant Design)    â”‚
â”‚  (Commander.js)    â”‚    ç«¯å£: 3000                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                     â”‚    Web APIå±‚                           â”‚
                     â”‚    (Express.js + Socket.IO)           â”‚
                     â”‚    ç«¯å£: 3001                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ä¸šåŠ¡é€»è¾‘å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¯”è¾ƒå¼•æ“     â”‚  æ•°æ®æå–å™¨   â”‚  æŠ¥å‘Šç”Ÿæˆå™¨  â”‚  ç¼“å­˜ç®¡ç†å™¨    â”‚
â”‚  (Comparers)  â”‚  (Extractors) â”‚  (Reporters) â”‚  (Cache)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ•°æ®è®¿é—®å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           æ•°æ®åº“è¿æ¥ç®¡ç† (mssql + Connection Pool)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ•°æ®å­˜å‚¨å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SQL Server    â”‚  æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨  â”‚  æ—¥å¿—å­˜å‚¨   â”‚  æŠ¥å‘Šå­˜å‚¨     â”‚
â”‚  (æº/ç›®æ ‡)     â”‚  (JSONç¼“å­˜)   â”‚  (Winston)  â”‚  (å¤šæ ¼å¼)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶å…³ç³»

```mermaid
graph TB
    A[ç”¨æˆ·ç•Œé¢] --> B[APIç½‘å…³]
    B --> C[å¢å¼ºæ¯”è¾ƒæœåŠ¡]
    C --> D[æ•°æ®åº“è¿æ¥ç®¡ç†å™¨]
    C --> E[å¯¹è±¡æå–å™¨]
    C --> F[æ¯”è¾ƒå¼•æ“]
    C --> G[æŠ¥å‘Šç”Ÿæˆå™¨]
    C --> H[ç¼“å­˜å­˜å‚¨]
    I[WebSocketæœåŠ¡] --> A
    C --> I
    D --> J[SQL Serveræº]
    D --> K[SQL Serverç›®æ ‡]
```

---

## 3. æŠ€æœ¯æ ˆåˆ†æ

### 3.1 åç«¯æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒæ¡†æ¶
- **Node.js 18+**: ç°ä»£JavaScriptè¿è¡Œæ—¶
- **TypeScript 5.x**: å¼ºç±»å‹è¯­è¨€æ”¯æŒï¼Œæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒ

#### Webæ¡†æ¶
- **Express.js 4.18**: è½»é‡çº§Webæ¡†æ¶
- **Socket.IO 4.7**: å®æ—¶åŒå‘é€šä¿¡
- **Helmet**: å®‰å…¨ä¸­é—´ä»¶
- **CORS**: è·¨åŸŸèµ„æºå…±äº«æ”¯æŒ
- **Morgan**: HTTPè¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶

#### æ•°æ®åº“è¿æ¥
- **mssql 11.0**: SQL Serverè¿æ¥é©±åŠ¨
- **è¿æ¥æ± ç®¡ç†**: è‡ªåŠ¨åŒ–è¿æ¥æ± ä¼˜åŒ–

#### æ—¥å¿—å’Œç›‘æ§
- **Winston 3.17**: ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ
- **UUID**: å”¯ä¸€æ ‡è¯†ç¬¦ç”Ÿæˆ

#### å·¥å…·åº“
- **Commander.js**: CLIå‘½ä»¤è¡Œè§£æ
- **Chalk**: ç»ˆç«¯é¢œè‰²è¾“å‡º
- **Joi**: æ•°æ®éªŒè¯æ¡†æ¶
- **ExcelJS**: Excelæ–‡ä»¶ç”Ÿæˆ
- **Handlebars**: HTMLæ¨¡æ¿å¼•æ“

### 3.2 å‰ç«¯æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒæ¡†æ¶
- **React 18.2**: ç°ä»£åŒ–å‰ç«¯æ¡†æ¶
- **TypeScript**: ç±»å‹å®‰å…¨å¼€å‘
- **Vite 5.0**: æé€Ÿæ„å»ºå·¥å…·

#### UIæ¡†æ¶
- **Ant Design 5.12**: ä¼ä¸šçº§UIç»„ä»¶åº“
- **@ant-design/icons**: å›¾æ ‡åº“

#### çŠ¶æ€ç®¡ç†å’Œé€šä¿¡
- **Axios 1.6**: HTTPå®¢æˆ·ç«¯
- **Socket.IO-Client**: WebSocketå®¢æˆ·ç«¯
- **React Router DOM**: è·¯ç”±ç®¡ç†

### 3.3 å¼€å‘å’Œæ„å»ºå·¥å…·

#### ä»£ç è´¨é‡
- **ESLint**: ä»£ç é£æ ¼æ£€æŸ¥
- **TypeScriptç¼–è¯‘å™¨**: ç±»å‹æ£€æŸ¥å’Œç¼–è¯‘
- **Jest**: å•å…ƒæµ‹è¯•æ¡†æ¶

#### æ„å»ºå’Œéƒ¨ç½²
- **TSC (TypeScript Compiler)**: åç«¯ç¼–è¯‘
- **Vite**: å‰ç«¯æ„å»º
- **ts-node**: å¼€å‘ç¯å¢ƒè¿è¡Œ
- **rimraf**: æ¸…ç†å·¥å…·

---

## 4. æ•°æ®åº“è¿æ¥æ¶æ„

### 4.1 è¿æ¥ç®¡ç†ç­–ç•¥

#### 4.1.1 æœåŠ¡å™¨åœ°å€è§£æ

æ”¯æŒå¤šç§æœåŠ¡å™¨åœ°å€æ ¼å¼:

```typescript
interface ParsedServer {
  server: string;
  port: number;
  hasExplicitPort: boolean;
}

// æ”¯æŒçš„æ ¼å¼:
// - localhost (é»˜è®¤ç«¯å£1433)
// - 192.168.1.100:1435 (å†’å·åˆ†éš”ç«¯å£)
// - server.example.com,26923 (é€—å·åˆ†éš”ç«¯å£)
// - SERVER\INSTANCE (å‘½åå®ä¾‹)
```

#### 4.1.2 è®¤è¯æ¨¡å¼æ”¯æŒ

**Windowsé›†æˆè®¤è¯**:
```typescript
{
  authentication: {
    type: 'windows'
  }
}
```

**SQL Serverè®¤è¯**:
```typescript
{
  authentication: {
    type: 'sql',
    username: 'sa',
    password: 'password'
  }
}
```

#### 4.1.3 è¿æ¥é…ç½®ä¼˜åŒ–

```typescript
const connectionConfig = {
  server: parsedServer.server,
  port: parsedServer.port,
  database: config.database,
  options: {
    encrypt: false,                    // ç¦ç”¨SSLåŠ å¯†
    trustServerCertificate: true,      // ä¿¡ä»»æœåŠ¡å™¨è¯ä¹¦
    enableArithAbort: true,            // å¯ç”¨ç®—æœ¯ä¸­æ­¢
    useUTC: false                      // ä½¿ç”¨æœ¬åœ°æ—¶åŒº
  },
  connectionTimeout: 10000,            // è¿æ¥è¶…æ—¶10ç§’
  requestTimeout: 10000                // è¯·æ±‚è¶…æ—¶10ç§’
};
```

### 4.2 è¿æ¥æ± ç®¡ç†

#### 4.2.1 è¿æ¥æ± é…ç½®
- **æœ€å°è¿æ¥æ•°**: 2
- **æœ€å¤§è¿æ¥æ•°**: 10
- **è¿æ¥è¶…æ—¶**: 10ç§’
- **ç©ºé—²è¶…æ—¶**: 30ç§’
- **è¿æ¥éªŒè¯**: å¯ç”¨

#### 4.2.2 è¿æ¥å¥åº·æ£€æŸ¥
```sql
-- ç®€å•è¿æ¥æµ‹è¯•
SELECT 1 as test

-- æ•°æ®åº“ç‰ˆæœ¬æ£€æŸ¥
SELECT @@VERSION as version
```

### 4.3 é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

#### 4.3.1 è¿æ¥ç­–ç•¥
1. **ä¸»è¦ç­–ç•¥**: ä½¿ç”¨è§£æåçš„è¿æ¥é…ç½®
2. **é‡è¯•æœºåˆ¶**: è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•3æ¬¡
3. **é™çº§ç­–ç•¥**: å‡å°‘è¿æ¥è¶…æ—¶æ—¶é—´é‡è¯•

#### 4.3.2 æ—¥å¿—è®°å½•
- **è¿æ¥æ—¥å¿—**: ç‹¬ç«‹çš„è¿æ¥æ—¥å¿—æ–‡ä»¶
- **è¯¦ç»†è®°å½•**: è¿æ¥å°è¯•ã€é”™è¯¯ã€æ€§èƒ½æŒ‡æ ‡
- **æ—¥å¿—è½®è½¬**: æŒ‰æ—¥æœŸè‡ªåŠ¨è½®è½¬æ—¥å¿—æ–‡ä»¶

---

## 5. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 5.1 æ•°æ®åº“å¯¹è±¡æå–å™¨ (Extractors)

#### 5.1.1 è¡¨ç»“æ„æå–å™¨ (TableExtractor)

**æ ¸å¿ƒåŠŸèƒ½**:
- è¡¨åŸºæœ¬ä¿¡æ¯æå–
- åˆ—è¯¦ç»†ä¿¡æ¯(æ•°æ®ç±»å‹ã€é•¿åº¦ã€æ˜¯å¦å¯ç©ºã€é»˜è®¤å€¼)
- ä¸»é”®å’Œå¤–é”®å…³ç³»
- ç´¢å¼•ä¿¡æ¯(èšé›†/éèšé›†)
- çº¦æŸä¿¡æ¯(CHECKã€UNIQUEç­‰)

**å…³é”®SQLæŸ¥è¯¢**:
```sql
-- è¡¨åŸºæœ¬ä¿¡æ¯
SELECT 
  t.TABLE_SCHEMA as schemaName,
  t.TABLE_NAME as tableName,
  t.TABLE_TYPE as tableType
FROM INFORMATION_SCHEMA.TABLES t
WHERE t.TABLE_TYPE = 'BASE TABLE'

-- åˆ—è¯¦ç»†ä¿¡æ¯
SELECT 
  c.COLUMN_NAME as columnName,
  c.DATA_TYPE as dataType,
  c.CHARACTER_MAXIMUM_LENGTH as maxLength,
  c.NUMERIC_PRECISION as precision,
  c.NUMERIC_SCALE as scale,
  c.IS_NULLABLE as isNullable,
  c.COLUMN_DEFAULT as defaultValue
FROM INFORMATION_SCHEMA.COLUMNS c
WHERE c.TABLE_SCHEMA = @schema AND c.TABLE_NAME = @table
```

#### 5.1.2 è§†å›¾æå–å™¨ (ViewExtractor)

**åŠŸèƒ½èŒƒå›´**:
- è§†å›¾å®šä¹‰æå–
- è§†å›¾ä¾èµ–å…³ç³»åˆ†æ
- è§†å›¾åˆ—ä¿¡æ¯
- è§†å›¾æƒé™ä¿¡æ¯

#### 5.1.3 å­˜å‚¨è¿‡ç¨‹æå–å™¨ (ProcedureExtractor)

**æå–å†…å®¹**:
- å­˜å‚¨è¿‡ç¨‹å®šä¹‰
- å‚æ•°ä¿¡æ¯
- è¿”å›ç±»å‹
- åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´

#### 5.1.4 å‡½æ•°æå–å™¨ (FunctionExtractor)

**æ”¯æŒçš„å‡½æ•°ç±»å‹**:
- æ ‡é‡å€¼å‡½æ•°
- è¡¨å€¼å‡½æ•°
- å†…è”è¡¨å€¼å‡½æ•°
- èšåˆå‡½æ•°

### 5.2 æ¯”è¾ƒå¼•æ“ (Comparers)

#### 5.2.1 è¡¨æ¯”è¾ƒå™¨ (TableComparer)

**æ¯”è¾ƒç»´åº¦**:
- è¡¨ç»“æ„å·®å¼‚
- åˆ—å˜æ›´(æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹)
- ç´¢å¼•å·®å¼‚
- çº¦æŸå˜æ›´
- æƒé™å·®å¼‚

**å·®å¼‚ç±»å‹**:
```typescript
enum DifferenceType {
  ADDED = 'added',
  REMOVED = 'removed', 
  MODIFIED = 'modified',
  IDENTICAL = 'identical'
}
```

#### 5.2.2 è§†å›¾æ¯”è¾ƒå™¨ (ViewComparer)

**æ¯”è¾ƒè¦ç‚¹**:
- è§†å›¾å®šä¹‰å˜æ›´
- ä¾èµ–å…³ç³»å˜åŒ–
- æ€§èƒ½å½±å“åˆ†æ

#### 5.2.3 å­˜å‚¨è¿‡ç¨‹æ¯”è¾ƒå™¨ (ProcedureComparer)

**æ¯”è¾ƒå†…å®¹**:
- è¿‡ç¨‹ä½“å·®å¼‚
- å‚æ•°åˆ—è¡¨å˜æ›´
- æƒé™å˜åŒ–

### 5.3 æ¯”è¾ƒç®—æ³•

#### 5.3.1 æ ¸å¿ƒç®—æ³•æµç¨‹

```typescript
class ComparisonEngine {
  async compare(source: DatabaseObjects, target: DatabaseObjects): Promise<ComparisonResult> {
    // 1. å¯¹è±¡åˆ†ç±»
    const sourceMap = this.buildObjectMap(source);
    const targetMap = this.buildObjectMap(target);
    
    // 2. å·®å¼‚è®¡ç®—
    const differences = [];
    
    // æ–°å¢å¯¹è±¡ (å­˜åœ¨äºç›®æ ‡ï¼Œä¸å­˜åœ¨äºæº)
    for (const [key, targetObj] of targetMap) {
      if (!sourceMap.has(key)) {
        differences.push({
          type: 'added',
          objectType: targetObj.type,
          objectName: key,
          target: targetObj
        });
      }
    }
    
    // åˆ é™¤å¯¹è±¡ (å­˜åœ¨äºæºï¼Œä¸å­˜åœ¨äºç›®æ ‡)
    for (const [key, sourceObj] of sourceMap) {
      if (!targetMap.has(key)) {
        differences.push({
          type: 'removed',
          objectType: sourceObj.type,
          objectName: key,
          source: sourceObj
        });
      }
    }
    
    // ä¿®æ”¹å¯¹è±¡ (åŒæ—¶å­˜åœ¨ï¼Œä½†æœ‰å·®å¼‚)
    for (const [key, sourceObj] of sourceMap) {
      const targetObj = targetMap.get(key);
      if (targetObj) {
        const objDiff = this.compareObjects(sourceObj, targetObj);
        if (objDiff.hasDifferences) {
          differences.push({
            type: 'modified',
            objectType: sourceObj.type,
            objectName: key,
            source: sourceObj,
            target: targetObj,
            differences: objDiff.differences
          });
        }
      }
    }
    
    return {
      summary: this.generateSummary(differences),
      differences,
      timestamp: new Date(),
      source: source.config,
      target: target.config
    };
  }
}
```

---

## 6. Webåº”ç”¨æ¶æ„

### 6.1 å‰ç«¯æ¶æ„è®¾è®¡

#### 6.1.1 ç»„ä»¶æ¶æ„

```
web-ui/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ComparisonProgress.tsx      # æ¯”è¾ƒè¿›åº¦ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ComparisonResults.tsx       # ç»“æœå±•ç¤ºç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ConfigManager.tsx           # é…ç½®ç®¡ç†ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DatabaseConfigForm.tsx      # æ•°æ®åº“é…ç½®è¡¨å•
â”‚   â”‚   â””â”€â”€ SessionRecoveryPrompt.tsx   # ä¼šè¯æ¢å¤æç¤º
â”‚   â”œâ”€â”€ pages/               # é¡µé¢ç»„ä»¶
â”‚   â”‚   â””â”€â”€ HomePage.tsx     # é¦–é¡µ
â”‚   â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ api.ts          # APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ socket.ts       # WebSocketæœåŠ¡
â”‚   â”‚   â””â”€â”€ TaskCacheManager.ts # ä»»åŠ¡ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ hooks/               # è‡ªå®šä¹‰Hook
â”‚   â”‚   â””â”€â”€ useSessionRecovery.ts # ä¼šè¯æ¢å¤Hook
â”‚   â””â”€â”€ types/               # ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ index.ts
```

#### 6.1.2 çŠ¶æ€ç®¡ç†ç­–ç•¥

**ç»„ä»¶çŠ¶æ€ç®¡ç†**:
- ä½¿ç”¨React Hooks (useState, useEffect, useCallback)
- è‡ªå®šä¹‰Hookå°è£…å¤æ‚é€»è¾‘
- Context APIç”¨äºå…¨å±€çŠ¶æ€å…±äº«

**æ•°æ®æµæ¨¡å¼**:
```typescript
// APIè°ƒç”¨ â†’ ç»„ä»¶çŠ¶æ€æ›´æ–° â†’ UIé‡æ¸²æŸ“
const [data, setData] = useState<T | null>(null);

useEffect(() => {
  apiService.getData()
    .then(setData)
    .catch(setError);
}, []);
```

### 6.2 åç«¯APIæ¶æ„

#### 6.2.1 è·¯ç”±è®¾è®¡

```
web-server/src/routes/
â”œâ”€â”€ compare.ts          # æ¯”è¾ƒç›¸å…³API
â”œâ”€â”€ reports.ts          # æŠ¥å‘Šç”ŸæˆAPI  
â”œâ”€â”€ configs.ts          # é…ç½®ç®¡ç†API
â””â”€â”€ database.ts         # æ•°æ®åº“è¿æ¥æµ‹è¯•API
```

#### 6.2.2 APIç«¯ç‚¹è®¾è®¡

```typescript
// æ¯”è¾ƒç›¸å…³ç«¯ç‚¹
POST /api/compare/start              # å¯åŠ¨æ¯”è¾ƒä»»åŠ¡
GET  /api/compare/status/:taskId     # è·å–ä»»åŠ¡çŠ¶æ€
GET  /api/compare/result/:taskId     # è·å–æ¯”è¾ƒç»“æœ
POST /api/compare/cancel/:taskId     # å–æ¶ˆæ¯”è¾ƒä»»åŠ¡

// æŠ¥å‘Šç›¸å…³ç«¯ç‚¹
POST /api/reports/generate/:taskId   # ç”ŸæˆæŠ¥å‘Š
GET  /api/reports/list/:taskId       # è·å–æŠ¥å‘Šåˆ—è¡¨
GET  /api/reports/download/:filename # ä¸‹è½½æŠ¥å‘Šæ–‡ä»¶

// é…ç½®ç®¡ç†ç«¯ç‚¹
GET  /api/configs                    # è·å–é…ç½®åˆ—è¡¨
POST /api/configs                    # ä¿å­˜é…ç½®
PUT  /api/configs/:id               # æ›´æ–°é…ç½®
DELETE /api/configs/:id             # åˆ é™¤é…ç½®

// æ•°æ®åº“è¿æ¥ç«¯ç‚¹
POST /api/database/test             # æµ‹è¯•æ•°æ®åº“è¿æ¥
```

### 6.3 ä¸­é—´ä»¶æ¶æ„

#### 6.3.1 Expressä¸­é—´ä»¶æ ˆ

```typescript
// å®‰å…¨ä¸­é—´ä»¶
app.use(helmet());

// CORSè·¨åŸŸ
app.use(cors({
  origin: process.env.NODE_ENV === 'production' 
    ? ['https://yourdomain.com'] 
    : ['http://localhost:3000'],
  credentials: true
}));

// è¯·æ±‚è§£æ
app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true }));

// è¯·æ±‚æ—¥å¿—
app.use(morgan('combined'));

// é™æ€æ–‡ä»¶æœåŠ¡
app.use('/reports', express.static(path.join(__dirname, '../reports')));
```

#### 6.3.2 é”™è¯¯å¤„ç†ä¸­é—´ä»¶

```typescript
app.use((error: any, req: Request, res: Response, next: NextFunction) => {
  logger.error('APIé”™è¯¯:', error);
  
  if (error.name === 'ValidationError') {
    return res.status(400).json({
      success: false,
      message: 'è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥',
      errors: error.details
    });
  }
  
  res.status(500).json({
    success: false,
    message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
    error: process.env.NODE_ENV === 'development' ? error.message : undefined
  });
});
```

---

## 7. å®æ—¶é€šä¿¡æœºåˆ¶

### 7.1 WebSocketæ¶æ„

#### 7.1.1 Socket.IOæœåŠ¡è®¾è®¡

```typescript
class SocketService {
  private io: Server;
  
  constructor(io: Server) {
    this.io = io;
    this.setupEvents();
  }
  
  private setupEvents() {
    this.io.on('connection', (socket) => {
      // å®¢æˆ·ç«¯åŠ å…¥ä»»åŠ¡æˆ¿é—´
      socket.on('join-task', (taskId: string) => {
        socket.join(`task-${taskId}`);
      });
      
      // å®¢æˆ·ç«¯ç¦»å¼€ä»»åŠ¡æˆ¿é—´
      socket.on('leave-task', (taskId: string) => {
        socket.leave(`task-${taskId}`);
      });
    });
  }
  
  // å‘é€è¿›åº¦æ›´æ–°
  public emitProgress(taskId: string, progress: ProgressData) {
    this.io.to(`task-${taskId}`).emit('progress', progress);
  }
  
  // å‘é€æ—¥å¿—ä¿¡æ¯
  public emitLog(taskId: string, log: LogData) {
    this.io.to(`task-${taskId}`).emit('log', log);
  }
  
  // å‘é€å®Œæˆäº‹ä»¶
  public emitComplete(taskId: string, result: ComparisonResult) {
    this.io.to(`task-${taskId}`).emit('complete', result);
  }
}
```

#### 7.1.2 å‰ç«¯WebSocketå®¢æˆ·ç«¯

```typescript
class SocketClient {
  private socket: Socket;
  
  connect() {
    this.socket = io('ws://localhost:3001', {
      transports: ['websocket', 'polling']
    });
    
    this.socket.on('connect', () => {
      console.log('WebSocketè¿æ¥æˆåŠŸ');
    });
    
    this.socket.on('disconnect', () => {
      console.log('WebSocketè¿æ¥æ–­å¼€');
    });
  }
  
  joinTask(taskId: string) {
    this.socket.emit('join-task', taskId);
  }
  
  onProgress(callback: (data: ProgressData) => void) {
    this.socket.on('progress', callback);
  }
  
  onComplete(callback: (result: ComparisonResult) => void) {
    this.socket.on('complete', callback);
  }
}
```

### 7.2 å®æ—¶äº‹ä»¶ç±»å‹

#### 7.2.1 è¿›åº¦äº‹ä»¶
```typescript
interface ProgressEvent {
  type: 'progress';
  taskId: string;
  step: string;           // å½“å‰æ­¥éª¤æè¿°
  percentage: number;     // å®Œæˆç™¾åˆ†æ¯”(0-100)
  message: string;        // è¯¦ç»†æ¶ˆæ¯
  details?: any;          // é¢å¤–è¯¦æƒ…
  timestamp: string;      // äº‹ä»¶æ—¶é—´æˆ³
}
```

#### 7.2.2 æ—¥å¿—äº‹ä»¶
```typescript
interface LogEvent {
  type: 'log';
  taskId: string;
  level: 'info' | 'warn' | 'error' | 'debug';
  message: string;
  timestamp: string;
  details?: any;
}
```

#### 7.2.3 å®Œæˆäº‹ä»¶
```typescript
interface CompleteEvent {
  type: 'complete';
  taskId: string;
  result: ComparisonResult;
  timestamp: string;
}
```

### 7.3 è¿æ¥ç®¡ç†ç­–ç•¥

#### 7.3.1 é‡è¿æœºåˆ¶
- **è‡ªåŠ¨é‡è¿**: è¿æ¥æ–­å¼€åè‡ªåŠ¨é‡è¯•
- **é‡è¿å»¶è¿Ÿ**: æŒ‡æ•°é€€é¿ç®—æ³•(1s, 2s, 4s, 8s...)
- **æœ€å¤§é‡è¿æ¬¡æ•°**: 10æ¬¡
- **è¿æ¥å¥åº·æ£€æŸ¥**: å¿ƒè·³æœºåˆ¶

#### 7.3.2 æˆ¿é—´ç®¡ç†
- **ä»»åŠ¡æˆ¿é—´**: æ¯ä¸ªæ¯”è¾ƒä»»åŠ¡åˆ›å»ºç‹¬ç«‹æˆ¿é—´
- **åŠ¨æ€åŠ å…¥/ç¦»å¼€**: å®¢æˆ·ç«¯å¯åŠ¨æ€åŠ å…¥å’Œç¦»å¼€ä»»åŠ¡æˆ¿é—´
- **æˆ¿é—´æ¸…ç†**: ä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ¸…ç†æˆ¿é—´

---

## 8. æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ

### 8.1 æŠ¥å‘Šç”Ÿæˆæ¶æ„

#### 8.1.1 æŠ¥å‘Šç”ŸæˆæœåŠ¡

```typescript
class ReportGenerationService {
  // ç”Ÿæˆå¤šæ ¼å¼æŠ¥å‘Š
  async generateReports(
    result: ComparisonResult, 
    taskId: string, 
    formats: ReportFormat[]
  ): Promise<Report[]> {
    const reports: Report[] = [];
    
    for (const format of formats) {
      try {
        const report = await this.generateSingleReport(result, taskId, format);
        reports.push(report);
      } catch (error) {
        console.error(`ç”Ÿæˆ${format}æŠ¥å‘Šå¤±è´¥:`, error);
      }
    }
    
    return reports;
  }
  
  private async generateSingleReport(
    result: ComparisonResult,
    taskId: string,
    format: ReportFormat
  ): Promise<Report> {
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const filename = `database-comparison-${taskId}-${timestamp}.${format}`;
    const outputPath = path.join(this.reportsDir, filename);
    
    let reporter: BaseReporter;
    switch (format) {
      case 'html':
        reporter = new HtmlReporter(this.logger);
        break;
      case 'excel':
        reporter = new ExcelReporter(this.logger);
        break;
      case 'json':
        reporter = new JsonReporter(this.logger);
        break;
      default:
        throw new Error(`ä¸æ”¯æŒçš„æŠ¥å‘Šæ ¼å¼: ${format}`);
    }
    
    const filePath = await reporter.generateReport(result, outputPath);
    
    return {
      id: crypto.randomUUID(),
      taskId,
      filename,
      format,
      filePath,
      fileSize: this.getFileSize(filePath),
      createdAt: new Date().toISOString()
    };
  }
}
```

### 8.2 æŠ¥å‘Šæ ¼å¼å®ç°

#### 8.2.1 HTMLæŠ¥å‘Š

**ç‰¹æ€§**:
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯æŸ¥çœ‹
- äº¤äº’å¼è¡¨æ ¼ï¼Œæ”¯æŒæ’åºå’Œç­›é€‰
- å·®å¼‚é«˜äº®æ˜¾ç¤º
- å†…ç½®CSSæ ·å¼ï¼Œæ— å¤–éƒ¨ä¾èµ–

**æŠ€æœ¯å®ç°**:
- **æ¨¡æ¿å¼•æ“**: Handlebars.js
- **æ ·å¼æ¡†æ¶**: å†…ç½®Bootstrapé£æ ¼CSS
- **å›¾è¡¨**: Chart.jsé›†æˆ
- **å¯¼å‡ºåŠŸèƒ½**: æ”¯æŒæ‰“å°å’ŒPDFå¯¼å‡º

#### 8.2.2 ExcelæŠ¥å‘Š

**å·¥ä½œè¡¨ç»“æ„**:
- **æ¦‚è¦**: æ¯”è¾ƒæ‘˜è¦ä¿¡æ¯
- **è¡¨å·®å¼‚**: è¡¨ç»“æ„å·®å¼‚è¯¦æƒ…
- **è§†å›¾å·®å¼‚**: è§†å›¾å·®å¼‚è¯¦æƒ…
- **å­˜å‚¨è¿‡ç¨‹å·®å¼‚**: å­˜å‚¨è¿‡ç¨‹å·®å¼‚è¯¦æƒ…
- **ç»Ÿè®¡ä¿¡æ¯**: å·®å¼‚ç»Ÿè®¡å›¾è¡¨

**æŠ€æœ¯å®ç°**:
- **åº“**: ExcelJS
- **æ ¼å¼åŒ–**: å•å…ƒæ ¼æ ·å¼ã€é¢œè‰²æ ‡è®°
- **å›¾è¡¨**: å†…ç½®Excelå›¾è¡¨æ”¯æŒ

#### 8.2.3 JSONæŠ¥å‘Š

**æ•°æ®ç»“æ„**:
```json
{
  "metadata": {
    "taskId": "task_123",
    "timestamp": "2025-08-20T10:30:00Z",
    "source": {...},
    "target": {...}
  },
  "summary": {
    "overallStatus": "different",
    "totalObjects": 150,
    "identicalObjects": 120,
    "differentObjects": 25,
    "addedObjects": 3,
    "removedObjects": 2
  },
  "differences": [
    {
      "type": "table",
      "name": "Users",
      "status": "modified",
      "changes": [...]
    }
  ]
}
```

### 8.3 æŠ¥å‘Šç®¡ç†

#### 8.3.1 æ–‡ä»¶å­˜å‚¨ç­–ç•¥
- **ç›®å½•ç»“æ„**: `reports/{taskId}/`
- **å‘½åè§„èŒƒ**: `{type}-{taskId}-{timestamp}.{ext}`
- **æ¸…ç†ç­–ç•¥**: 30å¤©åè‡ªåŠ¨æ¸…ç†æ—§æŠ¥å‘Š
- **å¤§å°é™åˆ¶**: å•ä¸ªæŠ¥å‘Šæœ€å¤§100MB

#### 8.3.2 æŠ¥å‘Šç¼“å­˜
- **å†…å­˜ç¼“å­˜**: æœ€è¿‘ç”Ÿæˆçš„æŠ¥å‘Šå…ƒæ•°æ®
- **ç£ç›˜ç¼“å­˜**: æŠ¥å‘Šæ–‡ä»¶æœ¬åœ°å­˜å‚¨
- **CDNé›†æˆ**: ç”Ÿäº§ç¯å¢ƒæ”¯æŒCDNåˆ†å‘

---

## 9. æ•°æ®ç¼“å­˜ä¸ä¼šè¯ç®¡ç†

### 9.1 ä»»åŠ¡æ•°æ®å­˜å‚¨

#### 9.1.1 TaskDataStorageæœåŠ¡

```typescript
class TaskDataStorage {
  private dataDir: string;
  private tasksDir: string;
  private resultsDir: string;
  
  constructor() {
    this.dataDir = path.join(process.cwd(), 'web-server', 'data');
    this.tasksDir = path.join(this.dataDir, 'tasks');
    this.resultsDir = path.join(this.dataDir, 'results');
    
    this.ensureDirectories();
  }
  
  // ä¿å­˜ä»»åŠ¡é…ç½®
  async saveTaskData(taskData: TaskData): Promise<void> {
    const filePath = path.join(this.tasksDir, `${taskData.taskId}.json`);
    await fs.writeFile(filePath, JSON.stringify(taskData, null, 2), 'utf8');
  }
  
  // ä¿å­˜æ¯”è¾ƒç»“æœ
  async saveComparisonResult(taskId: string, result: ComparisonResult): Promise<void> {
    const filePath = path.join(this.resultsDir, `${taskId}.json`);
    await fs.writeFile(filePath, JSON.stringify(result, null, 2), 'utf8');
  }
  
  // è·å–ä»»åŠ¡æ•°æ®
  async getTaskData(taskId: string): Promise<TaskData | null> {
    const filePath = path.join(this.tasksDir, `${taskId}.json`);
    
    try {
      const data = await fs.readFile(filePath, 'utf8');
      return JSON.parse(data);
    } catch (error) {
      return null;
    }
  }
}
```

#### 9.1.2 ç¼“å­˜ç­–ç•¥

**å¤šçº§ç¼“å­˜æ¶æ„**:
1. **å†…å­˜ç¼“å­˜**: æ´»è·ƒä»»åŠ¡æ•°æ®
2. **ç£ç›˜ç¼“å­˜**: ä»»åŠ¡é…ç½®å’Œç»“æœ
3. **æ•°æ®åº“ç¼“å­˜**: å…ƒæ•°æ®ç´¢å¼•(å¯é€‰)

**ç¼“å­˜æ›´æ–°ç­–ç•¥**:
- **å†™å…¥æ—¶æ›´æ–°**: æ•°æ®å˜æ›´æ—¶ç«‹å³æ›´æ–°ç¼“å­˜
- **å®šæ—¶åˆ·æ–°**: æ¯5åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡å†…å­˜ç¼“å­˜
- **LRUæ·˜æ±°**: å†…å­˜ä¸è¶³æ—¶æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„æ•°æ®

### 9.2 ä¼šè¯æ¢å¤æœºåˆ¶

#### 9.2.1 ä¼šè¯æ£€æµ‹

```typescript
class SessionRecoveryService {
  // æ£€æµ‹å¯æ¢å¤çš„ä¼šè¯
  async detectRecoverableSessions(): Promise<RecoverableSession[]> {
    const sessions: RecoverableSession[] = [];
    const taskFiles = await fs.readdir(this.tasksDir);
    
    for (const file of taskFiles) {
      if (file.endsWith('.json')) {
        const taskId = path.basename(file, '.json');
        const taskData = await this.getTaskData(taskId);
        
        if (taskData && this.isRecoverable(taskData)) {
          sessions.push({
            taskId,
            taskData,
            lastActivity: new Date(taskData.updatedAt),
            hasResult: await this.hasComparisonResult(taskId)
          });
        }
      }
    }
    
    return sessions.sort((a, b) => 
      b.lastActivity.getTime() - a.lastActivity.getTime()
    );
  }
  
  private isRecoverable(taskData: TaskData): boolean {
    // ä»»åŠ¡åœ¨24å°æ—¶å†…åˆ›å»º
    const createdAt = new Date(taskData.createdAt);
    const now = new Date();
    const timeDiff = now.getTime() - createdAt.getTime();
    const hoursDiff = timeDiff / (1000 * 60 * 60);
    
    return hoursDiff <= 24;
  }
}
```

#### 9.2.2 å‰ç«¯ä¼šè¯æ¢å¤

```typescript
const useSessionRecovery = () => {
  const [recoverableSessions, setRecoverableSessions] = useState<RecoverableSession[]>([]);
  const [showRecoveryPrompt, setShowRecoveryPrompt] = useState(false);
  
  useEffect(() => {
    const checkSessions = async () => {
      try {
        const sessions = await compareApi.getRecoverableSessions();
        if (sessions.length > 0) {
          setRecoverableSessions(sessions);
          setShowRecoveryPrompt(true);
        }
      } catch (error) {
        console.error('æ£€æµ‹ä¼šè¯æ¢å¤å¤±è´¥:', error);
      }
    };
    
    checkSessions();
  }, []);
  
  const recoverSession = async (sessionId: string) => {
    try {
      const result = await compareApi.recoverSession(sessionId);
      setShowRecoveryPrompt(false);
      return result;
    } catch (error) {
      console.error('æ¢å¤ä¼šè¯å¤±è´¥:', error);
      throw error;
    }
  };
  
  return {
    recoverableSessions,
    showRecoveryPrompt,
    recoverSession,
    dismissRecovery: () => setShowRecoveryPrompt(false)
  };
};
```

---

## 10. éƒ¨ç½²æ¶æ„

### 10.1 å¼€å‘ç¯å¢ƒéƒ¨ç½²

#### 10.1.1 å¿«é€Ÿå¯åŠ¨è„šæœ¬

**Windowsæ‰¹å¤„ç†è„šæœ¬**:
```batch
@echo off
echo å¯åŠ¨SQL Serveræ•°æ®åº“æ¯”è¾ƒå·¥å…·...

cd web-server
start "åç«¯æœåŠ¡" cmd /k "npm run dev"
timeout /t 3

cd ../web-ui  
start "å‰ç«¯æœåŠ¡" cmd /k "npm run dev"

echo æœåŠ¡å¯åŠ¨å®Œæˆ!
echo å‰ç«¯è®¿é—®: http://localhost:3000
echo åç«¯API: http://localhost:3001
```

#### 10.1.2 ä¾èµ–å®‰è£…è„šæœ¬

```batch
@echo off
echo å®‰è£…é¡¹ç›®ä¾èµ–...

echo å®‰è£…æ ¸å¿ƒæ¨¡å—ä¾èµ–...
call npm install

echo å®‰è£…Webåç«¯ä¾èµ–...
cd web-server
call npm install

echo å®‰è£…Webå‰ç«¯ä¾èµ–...
cd ../web-ui
call npm install

echo ä¾èµ–å®‰è£…å®Œæˆ!
```

### 10.2 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 10.2.1 Dockerå®¹å™¨åŒ–

**Dockerfile (åç«¯)**:
```dockerfile
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./
COPY web-server/package*.json ./web-server/

# å®‰è£…ä¾èµ–
RUN npm ci --only=production
RUN cd web-server && npm ci --only=production

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN npm run build
RUN cd web-server && npm run build

EXPOSE 3001

CMD ["npm", "start"]
```

**Docker Compose**:
```yaml
version: '3.8'

services:
  database-compare-backend:
    build: .
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - REPORTS_DIR=/app/reports
    volumes:
      - ./reports:/app/reports
      - ./logs:/app/logs
    restart: unless-stopped

  database-compare-frontend:
    build:
      context: ./web-ui
    ports:
      - "3000:80"
    depends_on:
      - database-compare-backend
    restart: unless-stopped
```

#### 10.2.2 Nginxåå‘ä»£ç†

```nginx
upstream backend {
    server localhost:3001;
}

server {
    listen 80;
    server_name yourdomain.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/database-compare;
        try_files $uri $uri/ /index.html;
    }
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # WebSocketä»£ç†
    location /socket.io/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 10.3 ç¯å¢ƒé…ç½®ç®¡ç†

#### 10.3.1 ç¯å¢ƒå˜é‡é…ç½®

```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®
NODE_ENV=production
PORT=3001
FRONTEND_PORT=3000

# æ•°æ®åº“é…ç½®
DB_CONNECTION_TIMEOUT=30000
DB_REQUEST_TIMEOUT=60000

# æ–‡ä»¶è·¯å¾„é…ç½®
REPORTS_DIR=/opt/database-compare/reports
LOGS_DIR=/opt/database-compare/logs

# å®‰å…¨é…ç½®
CORS_ORIGINS=https://yourdomain.com
SESSION_SECRET=your-secret-key

# æ€§èƒ½é…ç½®
WORKER_PROCESSES=4
MAX_MEMORY_USAGE=2GB
```

#### 10.3.2 é…ç½®æ–‡ä»¶ç®¡ç†

```typescript
// config/production.ts
export const productionConfig = {
  server: {
    port: process.env.PORT || 3001,
    host: process.env.HOST || '0.0.0.0'
  },
  database: {
    connectionTimeout: parseInt(process.env.DB_CONNECTION_TIMEOUT || '30000'),
    requestTimeout: parseInt(process.env.DB_REQUEST_TIMEOUT || '60000'),
    maxConnections: parseInt(process.env.DB_MAX_CONNECTIONS || '10')
  },
  storage: {
    reportsDir: process.env.REPORTS_DIR || path.join(process.cwd(), 'reports'),
    logsDir: process.env.LOGS_DIR || path.join(process.cwd(), 'logs')
  },
  security: {
    corsOrigins: process.env.CORS_ORIGINS?.split(',') || ['http://localhost:3000'],
    rateLimitMax: parseInt(process.env.RATE_LIMIT_MAX || '100')
  }
};
```

---

## 11. æ€§èƒ½ä¼˜åŒ–

### 11.1 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

#### 11.1.1 æŸ¥è¯¢ä¼˜åŒ–

**å¹¶è¡ŒæŸ¥è¯¢ç­–ç•¥**:
```typescript
async extractAllObjects(): Promise<DatabaseObjects> {
  // å¹¶è¡Œæå–ä¸åŒç±»å‹çš„å¯¹è±¡
  const [tables, views, procedures, functions] = await Promise.all([
    this.tableExtractor.extractAllTables(),
    this.viewExtractor.extractAllViews(),
    this.procedureExtractor.extractAllProcedures(),
    this.functionExtractor.extractAllFunctions()
  ]);
  
  return {
    tables,
    views,
    procedures,
    functions
  };
}
```

**åˆ†é¡µæŸ¥è¯¢å¤§å‹è¡¨**:
```sql
-- åˆ†é¡µè·å–è¡¨åˆ—è¡¨ï¼Œé¿å…å†…å­˜æº¢å‡º
SELECT * FROM (
  SELECT 
    ROW_NUMBER() OVER (ORDER BY TABLE_NAME) as RowNum,
    TABLE_SCHEMA,
    TABLE_NAME
  FROM INFORMATION_SCHEMA.TABLES
  WHERE TABLE_TYPE = 'BASE TABLE'
) t
WHERE RowNum BETWEEN @offset AND @limit;
```

#### 11.1.2 è¿æ¥æ± ä¼˜åŒ–

```typescript
const connectionConfig = {
  // è¿æ¥æ± é…ç½®
  pool: {
    max: 10,                    // æœ€å¤§è¿æ¥æ•°
    min: 2,                     // æœ€å°è¿æ¥æ•°
    idleTimeoutMillis: 30000,   // ç©ºé—²è¶…æ—¶
    acquireTimeoutMillis: 60000 // è·å–è¿æ¥è¶…æ—¶
  },
  
  // è¿æ¥é€‰é¡¹ä¼˜åŒ–
  options: {
    enableArithAbort: true,     // å¯ç”¨ç®—æœ¯ä¸­æ­¢
    abortTransactionOnError: true, // é”™è¯¯æ—¶ä¸­æ­¢äº‹åŠ¡
    useUTC: false,              // ä½¿ç”¨æœ¬åœ°æ—¶åŒº
    dateFirst: 1                // è®¾ç½®ä¸€å‘¨çš„ç¬¬ä¸€å¤©
  }
};
```

### 11.2 å†…å­˜ä¼˜åŒ–

#### 11.2.1 æµå¼å¤„ç†å¤§æ•°æ®

```typescript
async processLargeDataset<T>(
  query: string,
  processor: (row: T) => void
): Promise<void> {
  const request = this.pool.request();
  request.stream = true;
  
  const recordStream = request.query(query);
  
  return new Promise((resolve, reject) => {
    recordStream.on('row', (row: T) => {
      processor(row);
    });
    
    recordStream.on('done', () => {
      resolve();
    });
    
    recordStream.on('error', (error) => {
      reject(error);
    });
  });
}
```

#### 11.2.2 å¯¹è±¡æ± åŒ–

```typescript
class ObjectPool<T> {
  private pool: T[] = [];
  private createFn: () => T;
  private resetFn: (obj: T) => void;
  
  constructor(createFn: () => T, resetFn: (obj: T) => void, initialSize = 10) {
    this.createFn = createFn;
    this.resetFn = resetFn;
    
    // é¢„åˆ›å»ºå¯¹è±¡
    for (let i = 0; i < initialSize; i++) {
      this.pool.push(this.createFn());
    }
  }
  
  acquire(): T {
    const obj = this.pool.pop() || this.createFn();
    return obj;
  }
  
  release(obj: T): void {
    this.resetFn(obj);
    this.pool.push(obj);
  }
}
```

### 11.3 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### 11.3.1 è™šæ‹Ÿæ»šåŠ¨

```typescript
const VirtualTable: React.FC<VirtualTableProps> = ({ data, height = 400 }) => {
  const [startIndex, setStartIndex] = useState(0);
  const [endIndex, setEndIndex] = useState(10);
  const itemHeight = 40;
  const containerRef = useRef<HTMLDivElement>(null);
  
  const handleScroll = useCallback(
    throttle((event: React.UIEvent<HTMLDivElement>) => {
      const scrollTop = event.currentTarget.scrollTop;
      const newStartIndex = Math.floor(scrollTop / itemHeight);
      const visibleCount = Math.ceil(height / itemHeight);
      
      setStartIndex(newStartIndex);
      setEndIndex(newStartIndex + visibleCount);
    }, 16),
    [itemHeight, height]
  );
  
  const visibleItems = data.slice(startIndex, endIndex);
  
  return (
    <div
      ref={containerRef}
      style={{ height, overflowY: 'auto' }}
      onScroll={handleScroll}
    >
      <div style={{ height: data.length * itemHeight, position: 'relative' }}>
        {visibleItems.map((item, index) => (
          <div
            key={startIndex + index}
            style={{
              position: 'absolute',
              top: (startIndex + index) * itemHeight,
              width: '100%',
              height: itemHeight
            }}
          >
            <TableRow data={item} />
          </div>
        ))}
      </div>
    </div>
  );
};
```

#### 11.3.2 ç»„ä»¶ä¼˜åŒ–

```typescript
// ä½¿ç”¨React.memoé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const ComparisonResultRow = React.memo<ComparisonResultRowProps>(
  ({ difference, onSelect }) => {
    return (
      <tr onClick={() => onSelect(difference.id)}>
        <td>{difference.objectName}</td>
        <td>{difference.type}</td>
        <td>{difference.status}</td>
      </tr>
    );
  },
  (prevProps, nextProps) => {
    return prevProps.difference.id === nextProps.difference.id &&
           prevProps.difference.status === nextProps.difference.status;
  }
);

// ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ
const ComparisonSummary: React.FC<{ differences: Difference[] }> = ({ differences }) => {
  const summary = useMemo(() => {
    return {
      total: differences.length,
      added: differences.filter(d => d.type === 'added').length,
      removed: differences.filter(d => d.type === 'removed').length,
      modified: differences.filter(d => d.type === 'modified').length
    };
  }, [differences]);
  
  return (
    <div>
      <p>æ€»è®¡: {summary.total}</p>
      <p>æ–°å¢: {summary.added}</p>
      <p>åˆ é™¤: {summary.removed}</p>
      <p>ä¿®æ”¹: {summary.modified}</p>
    </div>
  );
};
```

---

## 12. å®‰å…¨æœºåˆ¶

### 12.1 æ•°æ®åº“è¿æ¥å®‰å…¨

#### 12.1.1 è¿æ¥å­—ç¬¦ä¸²ä¿æŠ¤

```typescript
class SecureConnectionManager {
  // åŠ å¯†å­˜å‚¨è¿æ¥ä¿¡æ¯
  encryptConnectionString(connStr: string, key: string): string {
    const cipher = crypto.createCipher('aes256', key);
    let encrypted = cipher.update(connStr, 'utf8', 'hex');
    encrypted += cipher.final('hex');
    return encrypted;
  }
  
  // è§£å¯†è¿æ¥ä¿¡æ¯
  decryptConnectionString(encrypted: string, key: string): string {
    const decipher = crypto.createDecipher('aes256', key);
    let decrypted = decipher.update(encrypted, 'hex', 'utf8');
    decrypted += decipher.final('utf8');
    return decrypted;
  }
  
  // éªŒè¯æ•°æ®åº“è¿æ¥æƒé™
  async validateDatabaseAccess(config: DatabaseConfig): Promise<boolean> {
    try {
      const connection = new DatabaseConnection(config, this.logger);
      await connection.connect();
      
      // æ£€æŸ¥è¯»å–æƒé™
      await connection.executeQuery('SELECT 1');
      
      // æ£€æŸ¥ç³»ç»Ÿè¡¨è®¿é—®æƒé™
      await connection.executeQuery(`
        SELECT COUNT(*) FROM INFORMATION_SCHEMA.TABLES 
        WHERE TABLE_TYPE = 'BASE TABLE'
      `);
      
      await connection.close();
      return true;
    } catch (error) {
      this.logger.error('æ•°æ®åº“æƒé™éªŒè¯å¤±è´¥:', error);
      return false;
    }
  }
}
```

#### 12.1.2 SQLæ³¨å…¥é˜²æŠ¤

```typescript
class SafeQueryBuilder {
  // å‚æ•°åŒ–æŸ¥è¯¢æ„å»ºå™¨
  buildParameterizedQuery(template: string, params: Record<string, any>): string {
    let query = template;
    
    Object.keys(params).forEach(key => {
      const value = this.sanitizeParameter(params[key]);
      query = query.replace(new RegExp(`@${key}`, 'g'), value);
    });
    
    return query;
  }
  
  private sanitizeParameter(value: any): string {
    if (typeof value === 'string') {
      // è½¬ä¹‰å•å¼•å·å’Œç‰¹æ®Šå­—ç¬¦
      return `'${value.replace(/'/g, "''")}'`;
    } else if (typeof value === 'number') {
      return value.toString();
    } else if (value instanceof Date) {
      return `'${value.toISOString()}'`;
    } else {
      throw new Error(`ä¸æ”¯æŒçš„å‚æ•°ç±»å‹: ${typeof value}`);
    }
  }
  
  // ç™½åå•éªŒè¯
  validateIdentifier(identifier: string): boolean {
    // åªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç‚¹å·
    const validPattern = /^[a-zA-Z_][a-zA-Z0-9_]*(\.[a-zA-Z_][a-zA-Z0-9_]*)*$/;
    return validPattern.test(identifier);
  }
}
```

### 12.2 Webåº”ç”¨å®‰å…¨

#### 12.2.1 èº«ä»½éªŒè¯å’Œæˆæƒ

```typescript
class AuthenticationMiddleware {
  // JWTä»¤ç‰ŒéªŒè¯
  async validateToken(req: Request, res: Response, next: NextFunction) {
    const token = req.headers.authorization?.replace('Bearer ', '');
    
    if (!token) {
      return res.status(401).json({ message: 'ç¼ºå°‘è®¤è¯ä»¤ç‰Œ' });
    }
    
    try {
      const decoded = jwt.verify(token, process.env.JWT_SECRET!) as any;
      req.user = decoded;
      next();
    } catch (error) {
      return res.status(401).json({ message: 'æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ' });
    }
  }
  
  // APIé™æµ
  createRateLimiter() {
    return rateLimit({
      windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿçª—å£
      max: 100, // æœ€å¤š100æ¬¡è¯·æ±‚
      message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•',
      standardHeaders: true,
      legacyHeaders: false
    });
  }
}
```

#### 12.2.2 æ•°æ®éªŒè¯å’Œæ¸…æ´—

```typescript
class InputValidation {
  // æ•°æ®åº“é…ç½®éªŒè¯
  validateDatabaseConfig(config: any): ValidationResult {
    const schema = Joi.object({
      server: Joi.string().required().max(255),
      database: Joi.string().required().max(128),
      authentication: Joi.object({
        type: Joi.string().valid('windows', 'sql').required(),
        username: Joi.when('type', {
          is: 'sql',
          then: Joi.string().required().max(128),
          otherwise: Joi.forbidden()
        }),
        password: Joi.when('type', {
          is: 'sql',
          then: Joi.string().required().max(128),
          otherwise: Joi.forbidden()
        })
      }).required(),
      options: Joi.object({
        connectionTimeout: Joi.number().min(1000).max(300000),
        requestTimeout: Joi.number().min(1000).max(600000)
      })
    });
    
    const { error, value } = schema.validate(config);
    
    return {
      isValid: !error,
      errors: error?.details,
      value
    };
  }
  
  // XSSé˜²æŠ¤
  sanitizeInput(input: string): string {
    return input
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#x27;')
      .replace(/\//g, '&#x2F;');
  }
}
```

### 12.3 æ–‡ä»¶å®‰å…¨

#### 12.3.1 æ–‡ä»¶è®¿é—®æ§åˆ¶

```typescript
class SecureFileManager {
  private allowedPaths: string[];
  
  constructor() {
    this.allowedPaths = [
      path.resolve(process.cwd(), 'reports'),
      path.resolve(process.cwd(), 'logs'),
      path.resolve(process.cwd(), 'web-server', 'data')
    ];
  }
  
  // è·¯å¾„éå†æ”»å‡»é˜²æŠ¤
  validatePath(filePath: string): boolean {
    const resolvedPath = path.resolve(filePath);
    
    return this.allowedPaths.some(allowedPath => 
      resolvedPath.startsWith(allowedPath)
    );
  }
  
  // å®‰å…¨æ–‡ä»¶è¯»å–
  async safeReadFile(filePath: string): Promise<string> {
    if (!this.validatePath(filePath)) {
      throw new Error('éæ³•çš„æ–‡ä»¶è·¯å¾„è®¿é—®');
    }
    
    // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if (!await this.fileExists(filePath)) {
      throw new Error('æ–‡ä»¶ä¸å­˜åœ¨');
    }
    
    // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé˜²æ­¢è¯»å–è¿‡å¤§æ–‡ä»¶ï¼‰
    const stats = await fs.stat(filePath);
    if (stats.size > 100 * 1024 * 1024) { // 100MBé™åˆ¶
      throw new Error('æ–‡ä»¶è¿‡å¤§ï¼Œæ— æ³•è¯»å–');
    }
    
    return await fs.readFile(filePath, 'utf8');
  }
}
```

---

## 13. æ‰©å±•æ€§è®¾è®¡

### 13.1 æ’ä»¶åŒ–æ¶æ„

#### 13.1.1 æå–å™¨æ’ä»¶æ¥å£

```typescript
interface IExtractor {
  readonly name: string;
  readonly version: string;
  readonly supportedObjectTypes: string[];
  
  initialize(connection: DatabaseConnection): Promise<void>;
  extract(objectType: string, options?: any): Promise<DatabaseObject[]>;
  cleanup(): Promise<void>;
}

// æå–å™¨æ³¨å†Œç®¡ç†
class ExtractorRegistry {
  private extractors = new Map<string, IExtractor>();
  
  register(extractor: IExtractor): void {
    this.extractors.set(extractor.name, extractor);
  }
  
  get(name: string): IExtractor | undefined {
    return this.extractors.get(name);
  }
  
  getAllByType(objectType: string): IExtractor[] {
    return Array.from(this.extractors.values())
      .filter(e => e.supportedObjectTypes.includes(objectType));
  }
}
```

#### 13.1.2 æ¯”è¾ƒå™¨æ’ä»¶æ¥å£

```typescript
interface IComparer {
  readonly name: string;
  readonly supportedObjectTypes: string[];
  
  compare(source: DatabaseObject[], target: DatabaseObject[]): Promise<ComparisonResult>;
  getComparisonDetails(sourceObj: DatabaseObject, targetObj: DatabaseObject): Promise<ObjectDifference>;
}

// è‡ªå®šä¹‰è¡¨æ¯”è¾ƒå™¨ç¤ºä¾‹
class CustomTableComparer implements IComparer {
  readonly name = 'custom-table-comparer';
  readonly supportedObjectTypes = ['table'];
  
  async compare(source: TableInfo[], target: TableInfo[]): Promise<ComparisonResult> {
    // è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘
    return {
      differences: [],
      summary: {
        total: 0,
        identical: 0,
        different: 0,
        added: 0,
        removed: 0
      }
    };
  }
  
  async getComparisonDetails(sourceTable: TableInfo, targetTable: TableInfo): Promise<ObjectDifference> {
    // è¯¦ç»†æ¯”è¾ƒé€»è¾‘
    return {
      objectName: sourceTable.name,
      objectType: 'table',
      differences: []
    };
  }
}
```

### 13.2 æ•°æ®åº“å¹³å°æ‰©å±•

#### 13.2.1 æ•°æ®åº“é€‚é…å™¨æ¥å£

```typescript
interface IDatabaseAdapter {
  readonly name: string;
  readonly supportedVersions: string[];
  
  createConnection(config: DatabaseConfig): Promise<IDatabaseConnection>;
  getSystemQueries(): SystemQueries;
  getDataTypeMapping(): DataTypeMapping;
}

interface SystemQueries {
  getTables: string;
  getColumns: string;
  getIndexes: string;
  getViews: string;
  getProcedures: string;
  getFunctions: string;
}

// MySQLé€‚é…å™¨ç¤ºä¾‹
class MySQLAdapter implements IDatabaseAdapter {
  readonly name = 'mysql';
  readonly supportedVersions = ['5.7', '8.0'];
  
  async createConnection(config: DatabaseConfig): Promise<IDatabaseConnection> {
    // MySQLè¿æ¥å®ç°
    return new MySQLConnection(config);
  }
  
  getSystemQueries(): SystemQueries {
    return {
      getTables: `
        SELECT 
          TABLE_SCHEMA as schemaName,
          TABLE_NAME as tableName
        FROM INFORMATION_SCHEMA.TABLES
        WHERE TABLE_TYPE = 'BASE TABLE'
      `,
      getColumns: `
        SELECT 
          COLUMN_NAME as columnName,
          DATA_TYPE as dataType,
          IS_NULLABLE as isNullable,
          COLUMN_DEFAULT as defaultValue
        FROM INFORMATION_SCHEMA.COLUMNS
        WHERE TABLE_SCHEMA = ? AND TABLE_NAME = ?
      `,
      // ... å…¶ä»–æŸ¥è¯¢
    };
  }
  
  getDataTypeMapping(): DataTypeMapping {
    return {
      'varchar': 'string',
      'int': 'number',
      'datetime': 'date',
      // ... ç±»å‹æ˜ å°„
    };
  }
}
```

### 13.3 æŠ¥å‘Šæ ¼å¼æ‰©å±•

#### 13.3.1 æŠ¥å‘Šç”Ÿæˆå™¨æ¥å£

```typescript
interface IReportGenerator {
  readonly format: string;
  readonly mimeType: string;
  readonly fileExtension: string;
  
  generate(result: ComparisonResult, options?: ReportOptions): Promise<ReportOutput>;
  validate(options?: ReportOptions): ValidationResult;
}

// PDFæŠ¥å‘Šç”Ÿæˆå™¨ç¤ºä¾‹
class PDFReportGenerator implements IReportGenerator {
  readonly format = 'pdf';
  readonly mimeType = 'application/pdf';
  readonly fileExtension = 'pdf';
  
  async generate(result: ComparisonResult, options?: ReportOptions): Promise<ReportOutput> {
    const doc = new PDFDocument();
    
    // PDFç”Ÿæˆé€»è¾‘
    doc.fontSize(20).text('æ•°æ®åº“æ¯”è¾ƒæŠ¥å‘Š', 100, 100);
    doc.fontSize(14).text(`æ¯”è¾ƒæ—¶é—´: ${result.timestamp}`);
    
    // æ·»åŠ æ¯”è¾ƒç»“æœå†…å®¹
    this.addSummarySection(doc, result.summary);
    this.addDifferencesSection(doc, result.differences);
    
    const buffer = await this.docToBuffer(doc);
    
    return {
      format: this.format,
      mimeType: this.mimeType,
      data: buffer,
      filename: `comparison-report-${Date.now()}.pdf`
    };
  }
  
  validate(options?: ReportOptions): ValidationResult {
    // éªŒè¯PDFç”Ÿæˆé€‰é¡¹
    return { isValid: true };
  }
  
  private async docToBuffer(doc: PDFDocument): Promise<Buffer> {
    return new Promise((resolve) => {
      const buffers: Buffer[] = [];
      doc.on('data', buffers.push.bind(buffers));
      doc.on('end', () => {
        resolve(Buffer.concat(buffers));
      });
      doc.end();
    });
  }
}
```

---

## 14. è¿ç»´ç›‘æ§

### 14.1 æ—¥å¿—ç³»ç»Ÿ

#### 14.1.1 ç»“æ„åŒ–æ—¥å¿—

```typescript
class StructuredLogger {
  private winston: winston.Logger;
  
  constructor(level: string, filename: string) {
    this.winston = winston.createLogger({
      level,
      format: winston.format.combine(
        winston.format.timestamp(),
        winston.format.errors({ stack: true }),
        winston.format.json()
      ),
      defaultMeta: { service: 'database-compare' },
      transports: [
        new winston.transports.File({ filename }),
        new winston.transports.Console({
          format: winston.format.simple()
        })
      ]
    });
  }
  
  // ç»“æ„åŒ–æ—¥å¿—æ–¹æ³•
  logComparison(event: string, data: any) {
    this.winston.info('æ¯”è¾ƒäº‹ä»¶', {
      event,
      timestamp: new Date().toISOString(),
      ...data
    });
  }
  
  logPerformance(operation: string, duration: number, metadata?: any) {
    this.winston.info('æ€§èƒ½æŒ‡æ ‡', {
      operation,
      duration,
      timestamp: new Date().toISOString(),
      ...metadata
    });
  }
  
  logError(operation: string, error: Error, context?: any) {
    this.winston.error('é”™è¯¯äº‹ä»¶', {
      operation,
      error: {
        name: error.name,
        message: error.message,
        stack: error.stack
      },
      context,
      timestamp: new Date().toISOString()
    });
  }
}
```

#### 14.1.2 æ—¥å¿—èšåˆ

```typescript
class LogAggregator {
  private metrics = new Map<string, MetricData>();
  
  // æ”¶é›†æ€§èƒ½æŒ‡æ ‡
  collectMetric(name: string, value: number, tags?: Record<string, string>) {
    const key = this.generateKey(name, tags);
    const existing = this.metrics.get(key);
    
    if (existing) {
      existing.count++;
      existing.sum += value;
      existing.max = Math.max(existing.max, value);
      existing.min = Math.min(existing.min, value);
      existing.avg = existing.sum / existing.count;
    } else {
      this.metrics.set(key, {
        name,
        count: 1,
        sum: value,
        max: value,
        min: value,
        avg: value,
        tags
      });
    }
  }
  
  // ç”ŸæˆæŒ‡æ ‡æŠ¥å‘Š
  generateReport(): MetricsReport {
    return {
      timestamp: new Date().toISOString(),
      metrics: Array.from(this.metrics.values()),
      summary: {
        totalMetrics: this.metrics.size,
        topSlowOperations: this.getTopSlowOperations(),
        errorRate: this.calculateErrorRate()
      }
    };
  }
  
  private getTopSlowOperations(): MetricData[] {
    return Array.from(this.metrics.values())
      .filter(m => m.name.includes('duration'))
      .sort((a, b) => b.avg - a.avg)
      .slice(0, 10);
  }
}
```

### 14.2 å¥åº·æ£€æŸ¥

#### 14.2.1 ç³»ç»Ÿå¥åº·ç›‘æ§

```typescript
class HealthChecker {
  private checks = new Map<string, HealthCheck>();
  
  // æ³¨å†Œå¥åº·æ£€æŸ¥
  registerCheck(name: string, check: HealthCheck) {
    this.checks.set(name, check);
  }
  
  // æ‰§è¡Œæ‰€æœ‰å¥åº·æ£€æŸ¥
  async runAllChecks(): Promise<HealthStatus> {
    const results: HealthCheckResult[] = [];
    
    for (const [name, check] of this.checks) {
      try {
        const startTime = Date.now();
        const result = await Promise.race([
          check.execute(),
          this.timeout(5000) // 5ç§’è¶…æ—¶
        ]);
        
        results.push({
          name,
          status: 'healthy',
          responseTime: Date.now() - startTime,
          message: result.message,
          timestamp: new Date().toISOString()
        });
      } catch (error) {
        results.push({
          name,
          status: 'unhealthy',
          responseTime: -1,
          message: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯',
          timestamp: new Date().toISOString()
        });
      }
    }
    
    const overallStatus = results.some(r => r.status === 'unhealthy') 
      ? 'unhealthy' 
      : 'healthy';
    
    return {
      status: overallStatus,
      checks: results,
      timestamp: new Date().toISOString()
    };
  }
  
  private timeout(ms: number): Promise<never> {
    return new Promise((_, reject) => {
      setTimeout(() => reject(new Error('å¥åº·æ£€æŸ¥è¶…æ—¶')), ms);
    });
  }
}

// æ•°æ®åº“è¿æ¥å¥åº·æ£€æŸ¥
class DatabaseHealthCheck implements HealthCheck {
  constructor(private config: DatabaseConfig) {}
  
  async execute(): Promise<HealthCheckResult> {
    try {
      const connection = new DatabaseConnection(this.config, new Logger('info'));
      await connection.connect();
      await connection.executeQuery('SELECT 1');
      await connection.close();
      
      return {
        healthy: true,
        message: 'æ•°æ®åº“è¿æ¥æ­£å¸¸'
      };
    } catch (error) {
      return {
        healthy: false,
        message: `æ•°æ®åº“è¿æ¥å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`
      };
    }
  }
}
```

### 14.3 ç›‘æ§æŒ‡æ ‡

#### 14.3.1 å…³é”®æ€§èƒ½æŒ‡æ ‡ (KPI)

```typescript
class PerformanceMonitor {
  private static instance: PerformanceMonitor;
  private metrics: Map<string, number[]> = new Map();
  
  // è®°å½•å“åº”æ—¶é—´
  recordResponseTime(operation: string, duration: number) {
    const key = `response_time_${operation}`;
    if (!this.metrics.has(key)) {
      this.metrics.set(key, []);
    }
    this.metrics.get(key)!.push(duration);
  }
  
  // è®°å½•å†…å­˜ä½¿ç”¨
  recordMemoryUsage() {
    const usage = process.memoryUsage();
    this.metrics.set('memory_rss', [usage.rss]);
    this.metrics.set('memory_heap_used', [usage.heapUsed]);
    this.metrics.set('memory_heap_total', [usage.heapTotal]);
  }
  
  // è®°å½•CPUä½¿ç”¨ç‡
  recordCpuUsage() {
    const usage = process.cpuUsage();
    this.metrics.set('cpu_user', [usage.user]);
    this.metrics.set('cpu_system', [usage.system]);
  }
  
  // ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
  generateReport(): PerformanceReport {
    const report: PerformanceReport = {
      timestamp: new Date().toISOString(),
      responseTime: this.calculateResponseTimeMetrics(),
      memory: this.getMemoryMetrics(),
      cpu: this.getCpuMetrics(),
      throughput: this.calculateThroughput()
    };
    
    return report;
  }
  
  private calculateResponseTimeMetrics(): ResponseTimeMetrics {
    const responseTimes = Array.from(this.metrics.entries())
      .filter(([key]) => key.startsWith('response_time_'))
      .reduce((acc, [operation, times]) => {
        const name = operation.replace('response_time_', '');
        acc[name] = {
          avg: times.reduce((a, b) => a + b, 0) / times.length,
          min: Math.min(...times),
          max: Math.max(...times),
          p95: this.calculatePercentile(times, 95),
          p99: this.calculatePercentile(times, 99)
        };
        return acc;
      }, {} as ResponseTimeMetrics);
    
    return responseTimes;
  }
}
```

#### 14.3.2 ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

```typescript
class BusinessMetricsCollector {
  private comparisonsCompleted = 0;
  private comparisonsFailed = 0;
  private reportsGenerated = 0;
  private averageComparisonTime = 0;
  
  // è®°å½•æ¯”è¾ƒå®Œæˆ
  recordComparisonCompleted(duration: number) {
    this.comparisonsCompleted++;
    this.averageComparisonTime = 
      (this.averageComparisonTime * (this.comparisonsCompleted - 1) + duration) 
      / this.comparisonsCompleted;
  }
  
  // è®°å½•æ¯”è¾ƒå¤±è´¥
  recordComparisonFailed() {
    this.comparisonsFailed++;
  }
  
  // è®°å½•æŠ¥å‘Šç”Ÿæˆ
  recordReportGenerated() {
    this.reportsGenerated++;
  }
  
  // è·å–ä¸šåŠ¡æŒ‡æ ‡
  getMetrics(): BusinessMetrics {
    const totalComparisons = this.comparisonsCompleted + this.comparisonsFailed;
    
    return {
      totalComparisons,
      successfulComparisons: this.comparisonsCompleted,
      failedComparisons: this.comparisonsFailed,
      successRate: totalComparisons > 0 ? this.comparisonsCompleted / totalComparisons : 0,
      reportsGenerated: this.reportsGenerated,
      averageComparisonTime: this.averageComparisonTime,
      timestamp: new Date().toISOString()
    };
  }
}
```

---

## 15. æ€»ç»“

### 15.1 æŠ€æœ¯æ¶æ„äº®ç‚¹

1. **å¤šå±‚åˆ†ç¦»æ¶æ„**: æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
2. **æ’ä»¶åŒ–è®¾è®¡**: æ”¯æŒæ•°æ®åº“å¹³å°å’ŒåŠŸèƒ½æ¨¡å—çš„çµæ´»æ‰©å±•
3. **å®æ—¶é€šä¿¡**: åŸºäºWebSocketçš„å®æ—¶è¿›åº¦è¿½è¸ªå’ŒçŠ¶æ€åŒæ­¥
4. **å¤šæ¨¡å¼æ”¯æŒ**: CLIå’ŒWebç•Œé¢åŒæ¨¡å¼ï¼Œæ»¡è¶³ä¸åŒä½¿ç”¨åœºæ™¯
5. **å¼ºç±»å‹æ”¯æŒ**: å…¨é¢ä½¿ç”¨TypeScriptï¼Œæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒå’Œä»£ç è´¨é‡

### 15.2 æ ¸å¿ƒæŠ€æœ¯ä¼˜åŠ¿

1. **é«˜æ€§èƒ½**: å¹¶è¡Œå¤„ç†ã€è¿æ¥æ± ä¼˜åŒ–ã€å†…å­˜ç®¡ç†ç­‰æ€§èƒ½ä¼˜åŒ–æªæ–½
2. **é«˜å¯ç”¨**: å®Œå–„çš„é”™è¯¯å¤„ç†ã€é‡è¯•æœºåˆ¶ã€å¥åº·æ£€æŸ¥
3. **å®‰å…¨å¯é **: å¤šå±‚å®‰å…¨é˜²æŠ¤ã€è¾“å…¥éªŒè¯ã€æƒé™æ§åˆ¶
4. **æ˜“äºéƒ¨ç½²**: Dockerå®¹å™¨åŒ–ã€è‡ªåŠ¨åŒ–è„šæœ¬ã€ç¯å¢ƒé…ç½®ç®¡ç†
5. **ç›‘æ§å®Œå–„**: ç»“æ„åŒ–æ—¥å¿—ã€æ€§èƒ½ç›‘æ§ã€ä¸šåŠ¡æŒ‡æ ‡è¿½è¸ª

### 15.3 æ‰©å±•å‘å±•æ–¹å‘

1. **å¤šæ•°æ®åº“æ”¯æŒ**: æ‰©å±•å¯¹PostgreSQLã€Oracleã€MySQLç­‰æ•°æ®åº“çš„æ”¯æŒ
2. **äº‘åŸç”Ÿéƒ¨ç½²**: æ”¯æŒKubernetesã€å¾®æœåŠ¡æ¶æ„
3. **AIå¢å¼º**: é›†æˆæœºå™¨å­¦ä¹ ç®—æ³•è¿›è¡Œæ™ºèƒ½å·®å¼‚åˆ†æå’Œå»ºè®®
4. **ç‰ˆæœ¬æ§åˆ¶**: é›†æˆGitç­‰ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ”¯æŒæ•°æ®åº“schemaç‰ˆæœ¬ç®¡ç†
5. **ä¼ä¸šé›†æˆ**: æ”¯æŒLDAPã€SSOç­‰ä¼ä¸šçº§èº«ä»½è®¤è¯å’Œæˆæƒç³»ç»Ÿ

### 15.4 é¡¹ç›®æˆç†Ÿåº¦

è¯¥é¡¹ç›®å·²ç»å…·å¤‡äº†ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„æŠ€æœ¯åŸºç¡€ï¼Œå…·æœ‰ï¼š

- âœ… å®Œæ•´çš„åŠŸèƒ½å®ç°
- âœ… è‰¯å¥½çš„æ¶æ„è®¾è®¡
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… å…¨é¢çš„æµ‹è¯•è¦†ç›–
- âœ… è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜
- âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- âœ… ç›‘æ§å’Œè¿ç»´æ”¯æŒ

è¯¥æŠ€æœ¯æ–¹æ¡ˆä¸ºä¼ä¸šçº§SQL Serveræ•°æ®åº“æ¯”è¾ƒå·¥å…·æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤æ‚æ•°æ®åº“ç¯å¢ƒä¸‹çš„æ¯”è¾ƒéœ€æ±‚ï¼Œå¹¶å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025å¹´8æœˆ20æ—¥  
**æŠ€æœ¯æ ˆç‰ˆæœ¬**: Node.js 18+, TypeScript 5.x, React 18, SQL Server 2008+
