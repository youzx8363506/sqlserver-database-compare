# æ•°æ®åº“æ¯”è¾ƒè¿æ¥é—®é¢˜ä¿®æ”¹æ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

### ç°çŠ¶å¯¹æ¯”
1. **æµ‹è¯•è¿æ¥åŠŸèƒ½** âœ… æ­£å¸¸å·¥ä½œ
   - è·¯å¾„: `web-server/src/routes/database.ts` çš„ `/test-connection` ç«¯ç‚¹
   - ä½¿ç”¨: ç›´æ¥çš„ `sql.ConnectionPool(config)` 
   - ç»“æœ: è¿æ¥æˆåŠŸ

2. **æ•°æ®åº“æ¯”è¾ƒåŠŸèƒ½** âŒ SSLåè®®é”™è¯¯  
   - è·¯å¾„: `src/app.ts` çš„ `compareDatabase` æ–¹æ³•
   - ä½¿ç”¨: ç›¸åŒé…ç½®ä½†ä»ç„¶å‡ºç°SSLé”™è¯¯
   - é”™è¯¯: `SSL routines:ssl_choose_client_version:unsupported protocol`

### æ ¹æœ¬åŸå› 
è™½ç„¶æˆ‘å¤åˆ¶äº†ç›¸åŒçš„è¿æ¥é…ç½®ï¼Œä½†æ¯”è¾ƒåŠŸèƒ½å¯èƒ½è¿˜åœ¨ä½¿ç”¨æ—§çš„ `DatabaseConnection` ç±»ï¼Œæˆ–è€…é…ç½®ä¸­æœ‰ç»†å¾®å·®å¼‚ã€‚

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šç›´æ¥å¤åˆ¶test-connectionçš„è¿æ¥é€»è¾‘ï¼ˆæ¨èï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `src/app.ts`

**å…·ä½“æ“ä½œ**:
1. å®Œå…¨åˆ é™¤å½“å‰çš„è¿æ¥é€»è¾‘
2. ç›´æ¥å¤åˆ¶ `web-server/src/routes/database.ts` ä¸­ `/test-connection` ç«¯ç‚¹çš„è¿æ¥ä»£ç 
3. ç¡®ä¿ä½¿ç”¨å®Œå…¨ç›¸åŒçš„åˆ›å»ºã€è¿æ¥ã€æŸ¥è¯¢æ¨¡å¼

### æ–¹æ¡ˆäºŒï¼šåˆ›å»ºé€šç”¨è¿æ¥å‡½æ•°

**æ–°å»ºæ–‡ä»¶**: `src/utils/database-connection.ts`

**å†…å®¹**: 
- æå–test-connectionä¸­æˆåŠŸçš„è¿æ¥é€»è¾‘åˆ°ç‹¬ç«‹å‡½æ•°
- ä¸¤ä¸ªåŠŸèƒ½éƒ½è°ƒç”¨è¿™ä¸ªç»Ÿä¸€å‡½æ•°
- ç¡®ä¿è¿æ¥é€»è¾‘å®Œå…¨ä¸€è‡´

## ğŸ› ï¸ è¯¦ç»†ä¿®æ”¹æ­¥éª¤

### æ­¥éª¤1: å¤‡ä»½å½“å‰ app.ts çš„è¿æ¥éƒ¨åˆ†
ä¿å­˜å½“å‰çš„å…ƒæ•°æ®æå–é€»è¾‘ï¼Œåªæ›¿æ¢è¿æ¥éƒ¨åˆ†

### æ­¥éª¤2: æ›¿æ¢è¿æ¥é€»è¾‘
å°† `compareDatabase` æ–¹æ³•ä¸­çš„è¿æ¥éƒ¨åˆ†æ›¿æ¢ä¸ºï¼š

```typescript
// ä½¿ç”¨ä¸test-connectionå®Œå…¨ç›¸åŒçš„è¿æ¥æ–¹å¼
const createConnection = async (server: string, database: string, authType: string, username?: string, password?: string) => {
  const config: any = {
    server: server,
    database: database,
    port: 1433,
    options: {
      encrypt: false,
      trustServerCertificate: true,
      enableArithAbort: true,
      useUTC: false
    },
    connectionTimeout: 10000,
    requestTimeout: 10000
  };

  if (authType === 'sql') {
    config.user = username;
    config.password = password;
  }

  const pool = new sql.ConnectionPool(config);
  await pool.connect();
  return pool;
};
```

### æ­¥éª¤3: åº”ç”¨åˆ°æºå’Œç›®æ ‡æ•°æ®åº“è¿æ¥
```typescript
// è¿æ¥æºæ•°æ®åº“
const sourcePool = await createConnection(
  sourceConfig.server,
  sourceConfig.database, 
  sourceConfig.authentication.type,
  sourceConfig.authentication.username,
  sourceConfig.authentication.password
);

// è¿æ¥ç›®æ ‡æ•°æ®åº“  
const targetPool = await createConnection(
  targetConfig.server,
  targetConfig.database,
  targetConfig.authentication.type, 
  targetConfig.authentication.username,
  targetConfig.authentication.password
);
```

## âœ… é¢„æœŸç»“æœ

ä¿®æ”¹ååº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¾“å‡ºï¼š
```
[æ•°æ®åº“æ¯”è¾ƒ-INFO] æ­£åœ¨è¿æ¥æºæ•°æ®åº“...
[æ•°æ®åº“æ¯”è¾ƒ-INFO] âœ… æºæ•°æ®åº“è¿æ¥æˆåŠŸ: 127.0.0.1/demo
[æ•°æ®åº“æ¯”è¾ƒ-INFO] æ­£åœ¨è¿æ¥ç›®æ ‡æ•°æ®åº“...
[æ•°æ®åº“æ¯”è¾ƒ-INFO] âœ… ç›®æ ‡æ•°æ®åº“è¿æ¥æˆåŠŸ: 127.0.0.1/demo
[æ•°æ®åº“æ¯”è¾ƒ-INFO] å¼€å§‹æå–æºæ•°æ®åº“å…ƒæ•°æ®...
```

è€Œä¸å†çœ‹åˆ°SSLåè®®é”™è¯¯ã€‚

## ğŸ¯ æ¨èæ–¹æ¡ˆ

**æ¨èä½¿ç”¨æ–¹æ¡ˆä¸€**ï¼Œå› ä¸ºï¼š
1. ç®€å•ç›´æ¥ï¼Œé£é™©æœ€ä½
2. ç¡®ä¿100%ä½¿ç”¨ç›¸åŒçš„è¿æ¥é€»è¾‘  
3. å¿«é€ŸéªŒè¯ä¿®å¤æ•ˆæœ
4. åç»­å¯ä»¥é‡æ„ä¸ºæ–¹æ¡ˆäºŒ

è¯·ç¡®è®¤è¿™ä¸ªä¿®æ”¹æ–¹æ¡ˆï¼Œæˆ‘å°†æŒ‰æ­¤æ–¹æ¡ˆä¿®æ”¹ä»£ç ã€‚