# SQL Server 数据库比较工具 - Web版本

## 项目概述

这是一个基于 Node.js 和 React 的 SQL Server 数据库比较工具，支持通过Web界面进行数据库结构比较，并生成多种格式的报告文件。

## 系统架构

- **后端**: Express.js + TypeScript + Socket.IO
- **前端**: React + TypeScript + Ant Design + Vite
- **数据库**: SQL Server（支持Windows认证和SQL认证）
- **报告格式**: HTML、Excel、JSON

## 功能特性

1. **数据库连接配置**: 支持Windows认证和SQL认证
2. **实时比较进度**: 通过WebSocket实时显示比较进度
3. **结构差异分析**: 比较表、索引、视图、存储过程、函数
4. **多格式报告**: 生成HTML、Excel、JSON格式的比较报告
5. **链接输出**: 生成可分享的报告链接
6. **响应式界面**: 支持PC和移动端访问

## 目录结构

```
sqlserverdatabasecompare/
├── src/                        # 原始CLI版本代码
│   ├── types/                  # TypeScript类型定义
│   ├── connections/            # 数据库连接管理
│   ├── extractors/             # 数据提取器
│   ├── comparators/            # 比较逻辑
│   ├── reporters/              # 报告生成器
│   └── utils/                  # 工具函数
├── web-server/                 # Web API服务器
│   ├── src/
│   │   ├── routes/             # API路由
│   │   ├── services/           # 业务服务
│   │   └── app.ts              # 服务器入口
│   └── package.json
├── web-ui/                     # React前端界面
│   ├── src/
│   │   ├── components/         # React组件
│   │   ├── pages/              # 页面组件
│   │   ├── services/           # API服务
│   │   └── types/              # 类型定义
│   └── package.json
└── reports/                    # 生成的报告文件
```

## 安装和启动

### 前置要求

- Node.js >= 18.12.1
- SQL Server 实例
- 有效的数据库连接权限

### 1. 安装依赖

```bash
# 安装后端依赖
cd web-server
npm install

# 安装前端依赖
cd ../web-ui
npm install
```

### 2. 启动后端服务

```bash
cd web-server
npm run dev
```

后端服务将启动在 `http://localhost:3001`

### 3. 启动前端界面

```bash
cd web-ui
npm run dev
```

前端界面将启动在 `http://localhost:3000`

### 4. 访问应用

打开浏览器访问 `http://localhost:3000` 开始使用数据库比较工具。

## 使用说明

### 第一步：配置数据库连接

1. 在左侧配置源数据库连接信息
2. 在右侧配置目标数据库连接信息
3. 选择认证方式（Windows认证或SQL Server认证）
4. 点击"测试数据库连接"确保连接成功

### 第二步：执行比较

1. 确保两个数据库连接测试都成功
2. 点击"开始数据库比较"按钮
3. 系统将显示实时比较进度和执行日志

### 第三步：查看结果

1. 比较完成后自动显示结果页面
2. 查看比较摘要和统计信息
3. 浏览详细的差异数据（按类型分类）
4. 生成和下载报告文件

### 报告格式说明

- **HTML格式**: 适合在线查看，包含完整的差异信息和样式
- **Excel格式**: 适合数据分析，每个差异类型单独一个工作表
- **JSON格式**: 适合程序处理，包含完整的结构化数据

## API接口

### 数据库相关

- `POST /api/database/test-connection` - 测试数据库连接
- `GET /api/database/objects` - 获取数据库对象列表
- `GET /api/database/info` - 获取数据库基本信息

### 比较相关

- `POST /api/compare/start` - 启动比较任务
- `GET /api/compare/status/:taskId` - 获取任务状态
- `GET /api/compare/result/:taskId` - 获取比较结果
- `GET /api/compare/differences/:taskId/:type` - 获取详细差异数据

### 报告相关

- `POST /api/reports/generate/:taskId` - 生成报告
- `GET /api/reports/list` - 获取报告列表
- `GET /api/reports/info/:fileName` - 获取报告信息
- `DELETE /api/reports/:fileName` - 删除报告

## WebSocket事件

- `comparison-progress` - 比较进度更新
- `comparison-complete` - 比较完成
- `comparison-error` - 比较错误
- `log-message` - 日志消息

## 开发相关

### 后端开发

```bash
cd web-server
npm run dev      # 开发模式
npm run build    # 构建
npm run start    # 生产模式
```

### 前端开发

```bash
cd web-ui
npm run dev      # 开发模式
npm run build    # 构建
npm run preview  # 预览构建结果
```

## 故障排除

### 数据库连接问题

1. 确保SQL Server服务正在运行
2. 检查网络连接和防火墙设置
3. 验证用户权限和认证信息
4. 确认数据库名称正确

### WebSocket连接问题

1. 检查后端服务是否正常启动
2. 确认端口3001没有被占用
3. 检查浏览器控制台错误信息

### 报告生成问题

1. 确保reports目录存在且可写
2. 检查磁盘空间是否充足
3. 验证任务是否已完成

## 技术支持

如有问题，请检查：
1. 控制台错误信息
2. 后端服务日志
3. 数据库连接状态
4. WebSocket连接状态

---

*SQL Server 数据库比较工具 v1.0.0*